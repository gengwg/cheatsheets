## Burn Raspbian to SD card

```
$ unzip -p 2020-12-02-raspios-buster-armhf-full.zip | sudo dd of=/dev/sdd bs=4M status=progress conv=fsync
```

## Configuration

update the mirror from here:

http://www.raspbian.org/RaspbianMirrors

```
$ cat  /etc/apt/sources.list
#deb http://raspbian.raspberrypi.org/raspbian/ stretch main contrib non-free rpi
deb http://mirrors.ocf.berkeley.edu/raspbian/raspbian stretch main contrib non-free rpi
```


## Nextcloud Installation on Raspberry Pi

http://unixetc.co.uk/2016/11/20/simple-nextcloud-installation-on-raspberry-pi/

### IP changes

```
raspberrypi:/var/www/html/nextcloud/config $ sudo vim config.php
  array (
    0 => '192.168.1.76',
    1 => '162.228.89.113',
    0 => '192.168.1.104', <---
  ),
  'datadirectory' => '/var/nextcloud/data',
  'overwrite.cli.url' => 'http://192.168.1.104/nextcloud', <---
```

raspberrypi:/media/pi/Touro/nextcloud# mount --bind /media/pi/Touro/nextcloud/ /var/nextcloud/data/

### Storage disk changes

1. Sync data from old disk to new disk.

```
sudo rsync -avzh /media/pi/Touro/nextcloud/ /media/pi/pidata/nextcloud/
```

2. Update data directory in `config.php`.

```
  'datadirectory' => '/media/pi/pidata/nextcloud/',
```

## Install Pihole

### Install

```
curl -sSL https://install.pi-hole.net | sudo bash
```

Record the Web Interface password at the end of instllation.

```
  [i] Web Interface password: ******
  [i] This can be changed using 'pihole -a -p'

  [i] View the web interface at http://pi.hole/admin or http://192.168.0.222/admin
```

### Open firewall 

Open firewall for UDP 53 for DNS service. (I also opened TCP).

```
raspberrypi:~$ sudo ufw allow from 192.168.0.0/24 to any port 53 proto udp
raspberrypi:~$ sudo ufw allow from 192.168.0.0/24 to any port 53 proto tcp
```

### Configure Router.

Following is using TPLink Router.

Go to:
https://192.168.0.1/
(DNS doesn't work now).

'Advanced' > 'Network' > 'DHCP Server'

Change **both** Primary and Secondary DNS to pihole IP address (e.g. 192.168.0.222):

```
Primary DNS: 192.168.0.222
Secondary DNS: 192.168.0.222
```
Looks one must change both. If I only change primary, 
it will put secondary automatically as 192.168.0.1, 
which will bypass pihole as DNS server.

### Log in to pihole admin page

http://192.168.0.222/admin

Use the password at the end of installation.

### Add block list from command line

```
$ sudo apt install sqlite3
$ sudo sqlite3 /etc/pihole/gravity.db "INSERT INTO adlist (address, enabled, comment) VALUES ('https://www.github.developerdan.com/hosts/lists/ads-and-tracking-extended.txt', 1, 'roku block list');"
$ pihole -g
```

Add from local list:

```
$ sudo sqlite3 /etc/pihole/gravity.db "DELETE FROM adlist"
$ sudo cat pihole.list | xargs -I {} sudo sqlite3 /etc/pihole/gravity.db "INSERT INTO adlist (Address) VALUES ('{}');"
$ pihole -g

```

## motion change data directory

```
sudo chown motion:adm /media/pi/Touro/motion/
sudo chmod 2750 /media/pi/Touro/motion/

# To test permission:
sudo -u motion touch /media/pi/Touro/motion/a
```
------------------------------------------------------
### 给树莓派安装中文输入法Fcitx及Google拼音输入法
```
sudo apt-get install fcitx fcitx-googlepinyin fcitx-module-cloudpinyin fcitx-sunpinyin

安装完毕，重启。
在preference那里找到Fcitx Configuration，点开，然后点击左下角的”+”号，找到你刚安装的google pinyin，添加之，It’s done, guys.
```

### disable the blank screen

```
vi /etc/lightdm/lightdm.conf
and in the [SeatDefaults] section add or uncomment this line:
xserver-command=X -s 0 -dpms

reboot
```

### rpi make caps lock key another ctrl

```
$ sudo vi ~/.config/lxkeymap.cfg
option = ctrl:nocaps
```

then

```
$ sudo reboot
```

if wants to swap the Ctrl and CapsLock keys, use:

```
option = ctrl:swapcaps
```

## Troubleshooting

### Eth0 got 169.254.x.x IP

That's the address it gets when it can not reach DHCP server. Just whitelist the MAC address of eth0.

If you search the Internet, it usually says disabling zeroconf. Don't do that!


### connect rpi to tv or monitor via hdmi. picture doesn't fill the enire size of the screen.

```
===>
vim /boot/config.txt
uncomment
# disable_overscan = 1

In TV remote, 'Home' > 'Picture' > 'Aspect Ratio' > Choose 'Just Scan'.
```

### DNS resolution is currently unavailable

```
    [✗] DNS resolution is currently unavailable*
    [✗] DNS resolution is not available*
```

===>

vim /etc/resolv.conf

And edit the name server to:

```
# Generated by NetworkManager
search home
nameserver 127.0.0.1
```
